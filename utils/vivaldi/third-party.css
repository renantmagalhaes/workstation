/* ========================================
   HIDE DISABLED NAVIGATION BUTTONS
   ======================================== */

/* Hide disabled forward/back navigation buttons */
.mainbar
  .toolbar-mainbar
  button.ToolbarButton-Button[disabled]:not(
    [name="Divider"]
  )[name="Back"] {
  display: none !important;
}

/* Show only enabled navigation buttons */
.mainbar
  .toolbar-mainbar
  button.ToolbarButton-Button:not(
    [disabled]
  )[name="Back"] {
  display: inline-flex !important;
}

/* ========================================
   TAB TRAIL EFFECTS - GREEN FOR TAB, RED FOR CLOSE BUTTON
   ======================================== */

/* Ensure tab-header is positioned relative for the absolute positioned trail */
.tab-position .tab .tab-header {
  position: relative;
  overflow: hidden;
}

/* Green trail element */
.tab-position .tab .tab-header::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 1%;
  height: 100%;
  background: linear-gradient(
    to left,
    rgba(0, 128, 0, 0.7) 0%,
    rgba(0, 128, 0, 0.5) 30%,
    rgba(0, 128, 0, 0.2) 60%,
    rgba(0, 128, 0, 0) 100%
  );
  transform: translateX(100%);
  opacity: 0;
  transition:
    transform 300ms ease-out,
    opacity 300ms ease-out;
  pointer-events: none;
  z-index: 1;
  /* border-radius: 12px !important; */
}

/* Red trail element */
.tab-position .tab .tab-header::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 50%;
  height: 100%;
  background: linear-gradient(
    to left,
    rgba(180, 0, 0, 0.7) 0%,
    rgba(180, 0, 0, 0.5) 30%,
    rgba(180, 0, 0, 0.2) 60%,
    rgba(180, 0, 0, 0) 100%
  );
  transform: translateX(100%);
  opacity: 0;
  transition:
    transform 300ms ease-out,
    opacity 300ms ease-out;
  pointer-events: none;
  z-index: 2;
  /* border-radius: 12px !important; */
}

/* Green trail show when tab is hovered (but not close button) */
.tab-position:not(.is-pinned)
  .tab:hover:not(:has(.close:hover))
  .tab-header::before {
  /* border-radius: 12px !important; */
  transform: translateX(0);
  opacity: 1;
}

/* Green trail show for active tab */
.tab-position
  .tab.active:not(:has(.close:hover))
  .tab-header::before,
.tab-position
  .tab.active:hover:not(
    :has(.close:hover)
  )
  .tab-header::before {
  /* border-radius: 12px !important; */
  transform: translateX(0);
  opacity: 1;
}

/* Red trail show when close button is hovered */
.tab-position
  .tab:hover
  .close:hover
  ~ .tab-header::after,
.tab-position
  .tab:hover
  .close:hover
  + .tab-header::after,
.tab-position
  .tab:has(.close:hover)
  .tab-header::after,
.tab-position
  .tab.active:has(.close:hover)
  .tab-header::after {
  /* border-radius: 12px !important; */
  transform: translateX(0);
  opacity: 1;
}

/* Hide green trail when red trail is active - slide out to left */
.tab-position
  .tab:has(.close:hover)
  .tab-header::before {
  /* border-radius: 12px !important; */
  transform: translateX(100%);
  opacity: 0;
  transition:
    transform 150ms ease-out,
    opacity 150ms ease-out;
}

/* Red trail return to base state when green trail is active */
.tab-position
  .tab:hover:not(:has(.close:hover))
  .tab-header::after {
  /* border-radius: 12px !important; */
  transform: translateX(100%);
  opacity: 0;
  transition:
    transform 150ms ease-out,
    opacity 150ms ease-out;
}

/* ========================================
   audo hide booksmarksbar when not hovered
   ======================================== */

#browser {
  --bookmark-bar-hide-delay: 400ms;
  --bookmark-bar-show-ctrlkey: true;
}

.bookmark-bar-top:is(
  .address-top,
  .tabs-top
) {
  #main:has(.bookmark-bar:hover)
    #webview-container {
    pointer-events: none !important;
  }
  &.tabs-top #tabs-subcontainer {
    -webkit-app-region: no-drag !important;
  }

  .bookmark-bar {
    height: 0 !important;
    border: none !important;
  }
  .bookmark-bar .observer {
    position: absolute !important;
    z-index: 4 !important;
    width: 100% !important;
    border-bottom: solid 1px
      var(--colorBorder) !important;
    clip-path: inset(
      0 0 100% 0
    ) !important;
    transition-delay: var(
      --bookmark-bar-hide-delay
    ) !important;
  }
  &:has(.button-disabled-preview):has(
      .tabbar-wrapper:hover
    ).tabs-top
    .bookmark-bar
    .observer,
  &:has(
      .button-disabled-preview
    ).address-top
    .bookmark-bar:is(
      .mainbar:not(
          :has(.OmniDropdown, nav.menu)
        ):hover
        ~ *
    )
    .observer,
  .bookmark-bar:is(
      :focus-within,
      :hover
    )
    .observer {
    clip-path: inset(
      0 0 -1px 0
    ) !important;
    transition: clip-path 150ms
      cubic-bezier(0, 1, 0, 0.9) 50ms !important;
  }
  @container not style(--bookmark-bar-show-ctrlkey: true) {
    &:has(
        .tabbar-wrapper:hover
      ).tabs-top
      .bookmark-bar
      .observer,
    &.address-top
      .bookmark-bar:is(
        .mainbar:not(
            :has(
              .OmniDropdown,
              nav.menu
            )
          ):hover
          ~ *
      )
      .observer,
    .bookmark-bar:is(
        :focus-within,
        :hover
      )
      .observer {
      clip-path: inset(
        0 0 -1px 0
      ) !important;
      transition: clip-path 150ms
        cubic-bezier(0, 1, 0, 0.9) 50ms !important;
    }
  }
  &.animation-off
    .bookmark-bar
    .observer {
    transition-duration: 0ms !important;
  }
}

/* ========================================
   DOWNLOAD PROGRESS STYLING
   ======================================== */

/* Download editor styling */
.panel.downloads
  section.download-editor {
  flex-basis: fit-content !important;
}

.panel.downloads
  section.download-editor
  > .data.disabled {
  max-height: 0;
}

.panel.downloads
  section.download-editor
  > .data:not(.disabled) {
  padding-bottom: 12px;
}

/* Progress bar base styling */
.button-toolbar .progress {
  background-color: black !important;
}

.button-toolbar .progress .loaded {
  transition: background-color 300ms
    ease-out 0s !important;
}

/* Progress color variations */
.button-toolbar
  .progress
  .loaded:is(
    [style^="width: 0."],
    [style^="width: 1."],
    [style^="width: 2."],
    [style^="width: 3."],
    [style^="width: 4."],
    [style^="width: 5."],
    [style^="width: 6."],
    [style^="width: 7."],
    [style^="width: 8."],
    [style^="width: 9."]
  ) {
  background-color: magenta;
}

.button-toolbar
  .progress
  .loaded[style^="width: 1"]:not(
    [style^="width: 1."]
  ):not([style^="width: 100%"]) {
  background-color: #ff0080;
}

.button-toolbar
  .progress
  .loaded[style^="width: 2"]:not(
    [style^="width: 2."]
  ) {
  background-color: darkorange;
}

.button-toolbar
  .progress
  .loaded[style^="width: 3"]:not(
    [style^="width: 3."]
  ) {
  background-color: orange;
}

.button-toolbar
  .progress
  .loaded[style^="width: 4"]:not(
    [style^="width: 4."]
  ) {
  background-color: gold;
}

.button-toolbar
  .progress
  .loaded[style^="width: 5"]:not(
    [style^="width: 5."]
  ) {
  background-color: yellow;
}

.button-toolbar
  .progress
  .loaded[style^="width: 6"]:not(
    [style^="width: 6."]
  ) {
  background-color: greenyellow;
}

.button-toolbar
  .progress
  .loaded[style^="width: 7"]:not(
    [style^="width: 7."]
  ) {
  background-color: limegreen;
}

.button-toolbar
  .progress
  .loaded[style^="width: 8"]:not(
    [style^="width: 8."]
  ) {
  background-color: mediumturquoise;
}

.button-toolbar
  .progress
  .loaded[style^="width: 9"]:not(
    [style^="width: 9."]
  ) {
  background-color: deepskyblue;
}

.button-toolbar
  .progress
  .loaded[style^="width: 100"] {
  background-color: lightcyan !important;
}

/* Progress counter styling */
.button-toolbar
  .progress
  .loaded::before,
.button-toolbar
  .progress
  .loaded::after {
  position: absolute;
  color: white;
  -webkit-text-stroke: 0.2px;
  text-shadow:
    -0.5px -0.5px 1px cyan,
    0.5px 0.5px 1px red,
    -1px 0 1px black,
    1px 0 1px black,
    0 -0.5px 1px black,
    0.5px 1.5px 1px black;
}

.button-toolbar
  .progress
  .loaded:not(
    [style^="width: 100%"]
  ):not([style^="width: 0%"])::before {
  content: attr(style);
  left: -3px;
  bottom: 1px;
  width: 13px;
  height: 30px;
  font-size: 10px;
  clip-path: inset(13px 0 0 0);
}

.button-toolbar
  .progress
  .loaded:not(
    [style^="width: 100%"]
  ):not([style^="width: 0%"]):not(
    [style^="width: 0."]
  ):not([style^="width: 1."]):not(
    [style^="width: 2."]
  ):not([style^="width: 3."]):not(
    [style^="width: 4."]
  ):not([style^="width: 5."]):not(
    [style^="width: 6."]
  ):not([style^="width: 7."]):not(
    [style^="width: 8."]
  ):not([style^="width: 9."])::before {
  left: -2.5px;
  width: 11.5px;
}

.button-toolbar
  .progress
  .loaded:not(
    [style^="width: 100%"]
  ):not([style^="width: 0%"])::after {
  content: "%";
  left: 11px;
  bottom: 6.5px;
  font-size: 8px;
}

.button-toolbar
  .progress
  .loaded:not(
    [style^="width: 100%"]
  ):not([style^="width: 0%"]):not(
    [style^="width: 0."]
  ):not([style^="width: 1."]):not(
    [style^="width: 2."]
  ):not([style^="width: 3."]):not(
    [style^="width: 4."]
  ):not([style^="width: 5."]):not(
    [style^="width: 6."]
  ):not([style^="width: 7."]):not(
    [style^="width: 8."]
  ):not([style^="width: 9."])::after {
  left: 9px;
}

/* Download icon opacity */
.button-toolbar
  > button[title="Downloads"]
  > span
  > svg {
  opacity: 0.4;
}

.tooltip {
  /* display: none !important; */
  opacity: 0 !important;
  pointer-events: none !important;
  /* transition: opacity 0.4s cubic-bezier(0.4, 0, 1, 1) 1s; */
}

body:has(
    .tab-position.is-substack
      > .tab-wrapper[aria-selected="false"]:hover
  )
  #vivaldi-tooltip
  .tooltip,
body:has(
    .tab-position.is-substack
      > .tab-wrapper[aria-selected="false"]
  )
  #vivaldi-tooltip:hover
  .tooltip {
  opacity: 1 !important;
  pointer-events: auto !important;
  /* transition: opacity 0.4s cubic-bezier(0.4, 0, 1, 1) 1s; */
}

#vivaldi-tooltip
  .tooltip-item
  .thumbnail-image,
span.info.size,
span.info.size.off {
  display: none !important;
}

@keyframes tooltipFadeIn {
  from {
    opacity: 0;
    transform: scale(0.3);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes tooltipFadeOut {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.3);
  }
}

/* body:has(.tab-position.is-substack:hover) #vivaldi-tooltip .tooltip,
body:has(.tab-position.is-substack) #vivaldi-tooltip:hover .tooltip { */

#vivaldi-tooltip .tooltip {
  background-color: black;
  flex-direction: column;
  width: 240px !important;
  min-height: 30px;
  max-height: 280px;
  overflow: hidden;
  border-radius: calc(
    var(--radius) + 3px
  );
}

body:has(
    .tab-position.is-substack:hover
  )
  #vivaldi-tooltip
  .tooltip {
  animation: tooltipFadeIn 0.4s
    cubic-bezier(0.16, 1, 0.3, 1)
    forwards;
}

body:not(
    :has(
      .tab-position.is-substack:hover
    )
  )
  #vivaldi-tooltip
  .tooltip:not(:hover) {
  animation: tooltipFadeOut 0.4s
    cubic-bezier(0.4, 0, 1, 1) 1s
    forwards;
}

#vivaldi-tooltip .tooltip {
  transition:
    opacity 0.4s
      cubic-bezier(0.4, 0, 1, 1) 1s,
    transform 0.4s
      cubic-bezier(0.4, 0, 1, 1) 1s;
}

body:has(#tabs-container.left)
  #vivaldi-tooltip
  .tooltip {
  left: calc(
    var(--tabs-container-expand-width) -
      calc(var(--densityGap) * 2)
  ) !important;
  right: auto !important;
  transform-origin: left;
}

body:has(#tabs-container.right)
  #vivaldi-tooltip
  .tooltip {
  right: calc(
    var(--tabs-container-expand-width) -
      calc(var(--densityGap) * 2)
  ) !important;
  left: auto !important;
  transform-origin: right;
}

div.tooltip .tab-group {
  width: 100% !important;
  height: 100% !important;
  overflow-x: hidden;
  overflow-y: scroll;
  padding: 3px !important;

  scrollbar-width: thin;
  scrollbar-color: rgba(
      255,
      255,
      255,
      0.3
    )
    transparent;

  &::-webkit-scrollbar {
    width: 4px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background-color: rgba(
      255,
      255,
      255,
      0.3
    );
    border-radius: 2px;
  }

  &::-webkit-scrollbar-thumb:hover {
    background-color: rgba(
      255,
      255,
      255,
      0.5
    );
  }
}

div.tooltip {
  & .tooltip-item {
    background-color: black !important;
    max-width: 100% !important;
    height: 50px !important;
    overflow: hidden;
    z-index: 10;

    & .thumbnail-caption {
      overflow: hidden;
      max-width: 100%;
    }

    & .thumbnail-text {
      display: block;
      overflow: hidden;
      max-width: 100%;
      width: 100%;
    }

    & .thumbnail-buttons {
      align-items: flex-start !important;
      justify-content: flex-start !important;
      order: -1;
    }
  }

  & .title {
    display: block;
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    box-sizing: border-box;
    font-size: 80%;
    z-index: 30;
  }

  & .url {
    display: block;
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    box-sizing: border-box;
    font-size: 60%;
    color: grey;
    z-index: 30;
  }

  .tooltip-item::before {
    content: "";
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(
      114,
      114,
      114,
      0.4
    );
    z-index: 20;
  }

  .tooltip-item:hover::before {
    display: block;
  }
}

/* body:has(.tab-position > .tab-wrapper[aria-selected="true"]:hover) #vivaldi-tooltip .tooltip,
body:has(.tab-position:not(.is-substack):hover) #vivaldi-tooltip .tooltip,
body:has(.is-substack):not(:hover) #vivaldi-tooltip .tooltip{
  display: none !important;
} */

/* .tab-position.is-substack span.favicon.jstest-favicon-image {
  position: relative !important;
  display: inline-block !important;
  width: 28px !important;
  height: 28px !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: visible !important;
}

.tab-position.is-substack span.favicon.jstest-favicon-image img {
  display: none !important;
}

.tab-position.is-substack span.favicon.jstest-favicon-image::before {
  content: '' !important;
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 18px !important;
  height: 18px !important;
  display: block !important;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z'/%3E%3C/svg%3E") !important;
  background-size: contain !important;
  background-repeat: no-repeat !important;
  background-position: center !important;
  z-index: 10 !important;
} */

/* .is-substack .tab-header .title{
  color: white;
  mix-blend-mode: difference;
}

:not(.is-substack) .tab-header .title{
  color: var(--colorFg);
} */
